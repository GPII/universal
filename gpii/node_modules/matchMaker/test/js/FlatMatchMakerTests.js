/*
 * GPII Flat MatchMaker Tests
 *
 * Copyright 2012 OCAD University
 * Copyright 2012 Raising The Floor - International
 *
 * Licensed under the New BSD license. You may not use this file except in
 * compliance with this License.
 *
 * The research leading to these results has received funding from the European Union's
 * Seventh Framework Programme (FP7/2007-2013)
 * under grant agreement no. 289016.
 *
 * You may obtain a copy of the License at
 * https://github.com/GPII/universal/blob/master/LICENSE.txt
 */

// Declare dependencies
/* global jqUnit */

var fluid = fluid || require("infusion");
var gpii = fluid.registerNamespace("gpii");

(function () {
    "use strict";

    fluid.registerNamespace("gpii.tests.flatMatchMaker");

    var magnifier = {"settingsHandlers": [{
        "type": "gpii.integrationTesting.mockSettingsHandler",
        "capabilities": ["display.screenEnhancement"],
        "capabilitiesTransformations": {
            "mag-factor": "display.screenEnhancement.magnification",
            "show-cross-hairs": "display.screenEnhancement.-provisional-showCrosshairs",
            "mouse-tracking": {
                "transform": {
                    "type": "fluid.transforms.valueMapper",
                    "inputPath": "display.screenEnhancement.tracking",
                    "options": {
                        "mouse": {
                            "outputValue": "centered"
                        }
                    }
                }
            }
        }
    }]
    };

    var sammyProfile = {
        "display": {
            "screenEnhancement": {
                "fontSize": 24,
                "foregroundColor": "white",
                "backgroundColor": "black",
                "fontFace": {
                    "fontName": ["Comic Sans"],
                    "genericFontFace": "sans serif"
                },
                "magnification": 2.0,
                "tracking": ["mouse"],
                "invertImages": true,
                "-provisional-showCrosshairs": true
            }
        }
    };

    var carlaBit = {
        "content": {
            "adaptationPreference": [
                {
                    "adaptationType": "caption",
                    "language": "en"
                },
                {}
            ]
        }
    };

    var carlaBit2 = {
        "display": {
            "applications": [{
                "name": "UI Options",
                "id": "fluid.uiOptions.windows"
            }]
        }
    };

    var matchMaker = gpii.matchMaker;

    var runFlat = function(profile, solutions) {
        return matchMaker.disposeSolutions(profile, solutions, matchMaker.flat.disposeStrategy);
    };

    gpii.tests.flatMatchMaker.runTests = function() {

        jqUnit.module("MatchMaker");
        jqUnit.test("Rank and dispose solutions", function() {
            runFlat(sammyProfile, [magnifier]).then(function (disposed) {
                jqUnit.assertEquals("Accepted relevant solution", "accept", disposed[0].disposition);
            });
            runFlat(carlaBit, [magnifier]).then(function (disposed) {
                jqUnit.assertEquals("Rejected irrelevant solution", "reject", disposed[0].disposition);
            });
            runFlat(carlaBit2, [magnifier]).then(function (disposed) {
                jqUnit.assertEquals("Rejected mostly irrelevant solution", "reject", disposed[0].disposition);
            });
        });
    };

}());