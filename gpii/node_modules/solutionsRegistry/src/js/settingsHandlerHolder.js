"use strict";
var fluid = require("infusion");

fluid.defaults("gpii.solutionsRegistry.settingsHandlerHolder", {
    gradeNames: ["fluid.component"],
    rules: {
        settingsDefToOptions: {
            "": "",
            "type": {
                transform: {
                    type: "fluid.transforms.delete"
                }
            },
            "parents": {
                transform: {
                    type: "fluid.transforms.delete"
                }
            }
        },
        settingsDefToType: {
            "": {
                transform: {
                    type: "fluid.transforms.firstValue",
                    values: ["type", { literalValue: "gpii.solutionsRegistry.setting"}]
                }
            }
        }
    },
    dynamicComponents: {
        setting: {
            sources: "@expand:fluid.hashToArray({settingsHandlerHolder}.options.supportedSettings,\"settingKey\")",
            type: {
                expander: {
                    func: "fluid.model.transformWithRules",
                    args: ["{source}", "{settingsHandlerHolder}.options.rules.settingsDefToType"] // object, rules, options
                }
            },
            options: {
                gradeNames: "{source}.parents",
                // We have to stuff the payload into a child element to avoid breaking things by expanding all options.
                settingOptions: {
                    expander: {
                        func: "fluid.model.transformWithRules",
                        args: ["{source}", "{settingsHandlerHolder}.options.rules.settingsDefToOptions"] // object, rules, options
                    }
                }
            }
        }
    }
});
