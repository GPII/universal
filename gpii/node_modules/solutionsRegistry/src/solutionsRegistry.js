/*
 * GPII Solutions Registry
 *
 * Copyright 2012 OCAD University
 *
 * Licensed under the New BSD license. You may not use this file except in
 * compliance with this License.
 *
 * The research leading to these results has received funding from the European Union's
 * Seventh Framework Programme (FP7/2007-2013)
 * under grant agreement no. 289016.
 *
 * You may obtain a copy of the License at
 * https://github.com/GPII/universal/blob/master/LICENSE.txt
 */

"use strict";

var fluid = require("infusion"),
    path = require("path");

fluid.require("./solutionGet.js", require);
fluid.require("./solutionPost.js", require);
fluid.require("./solutionQuery.js", require);

fluid.defaults("gpii.solutionsRegistry", {
    gradeNames: ["kettle.app", "autoInit"],
    handlers: {
        solutionGet: {
            route: "/solution/:id",
            type: "get"
        },
        solutionPost: {
            route: "/solution/:id",
            type: "post"
        },
        solutionQuery: {
            route: "/solution?:query",
            type: "get"
        }
    },
    solutionsRegistryUrl: "",
    solutionQueryUrl: "",
    root: path.join(__dirname, ".."),
    components: {
        solutionSource: {
            type: "kettle.dataSource.CouchDB",
            options: {
                url: "{gpii.solutionsRegistry}.options.solutionsRegistryUrl",
                writable: true,
                termMap: {
                    id: "%id"
                }
            }
        },
        solutionQuerySource: {
            type: "kettle.dataSource.CouchDB",
            options: {
                url: "{gpii.solutionsRegistry}.options.solutionQueryUrl",
                termMap: {
                    os: "%os"
                }
            }
        }
    }
});

fluid.defaults("gpii.solutionsRegistry.dev", {
    gradeNames: ["autoInit", "fluid.littleComponent", "kettle.urlExpander.distributeDevVariables"],
    components: {
        solutionSource: {
            type: "kettle.dataSource.URL"
        },
        solutionQuerySource: {
            type: "kettle.dataSource.URL"
        }
    }
});

