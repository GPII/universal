# Card Tests

These tests are not performed by CI - they operate on a real card.

## The tests

`real-card-tests.js` performs the following tests:

* Detect card type.
* Get the token from the card.

### Usage

The universal repo doesn't provide the pcsc library. In order to get this, either run inside gpii-windows, or
run `npm install @pokusew/pcsclite`.

1. Attach a reader.
2. Run `node real-card-tests.js`.
3. Put a card on the reader. The card can contain any tag.
4. The tests will run, showing PASS or FAIL at the end.

## Transaction logger

`record.js` records the transaction of retrieving a token from the card, outputting json that can be placed in
[cards.json5](../testData/cards.json5). These transactions are used to mock cards, in the unit tests.

### Usage

1. Attach a reader.
2. Run `node record.js`
3. Put a card on the reader. The card can contain any tag.
4. The tag will be read from the card, and some JSON will be displayed. Add a `name` field, and the JSON can be used in
   [cards.json5](../testData/cards.json5) to mock the card.

### Example log

```json
{
  "atr": "3b8f8001804f0ca000000306030001000000006a",
  "cardType": "Mifare",
  "commands": {
    "ff860000050100046000": "6300",
    "ff860000050100046100": "9000",
    "ffb0000410": "030bd101075402656e656c6f64fe00009000"
  },
  "expect": {
    "text": "elod"
  }
}
```
