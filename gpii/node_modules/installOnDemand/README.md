# Install on Demand

Provides the ability to install software on demand.

The stages of installation:

### start

* Gets the package info from the server.
* `requirePackage` finds a suitable `gpii.iod.packageInstaller` for the package.

### initialise
Creates a temporary directory, starts the following pipeline.

### download
Downloads the package.

### check
Checks the downloaded package.

### prepareInstall
Generates the installation commands.

### install
Installs the package.

### cleanup
Cleans the files.


## Parts

### `gpii.iod`

The install on demand component.

### `gpii.iod.packageInstaller`

Base component of the package installers, which perform the work that's specific to the type of package being installed.
Implementations will probably be found in the OS-specific repository.

This performs the initialise->cleanup pipeline.

### `gpii.iod.packageDataSource`

The package data source.

## Packages

Packages consist of a `packageInfo` json file, and the package file. Support can be provided for different types of
packages, however chocolatey already does a good job at wrapping installers.

```javascript
/**
 * @typedef {Object} packageInfo
 * @property {string} name - The package name.
 * @property {string} url - The package location (optional, to override the IoD server with an external location).
 * @property {string} filename - The package filename.
 * @property {string} packageType - Type of installer to use.
 * @property {string} hash - The signed hash of the package.
 */
packageInfo = {
    name: "some-package",
    url: "https://iod-server.example.com/some-package",
    filename: "some-package.1.0.0.nupkg",
    packageType: "chocolatey"
}
```

### Multi-lingual packages

Multiple languages can be supported in a single package, like so:

```json
{
    "name": "another-package",
    "url": "https://example.com/default-language",
    "languages": {
        "en-GB": {
            "url": "https://example.com/real-english"
        },
        "es": {
            "url": "https://example.com/general-spanish"
        },
        "es-ES": {
            "url": "https://example.com/spainish-spanish"
        },
        "es-MX": {
            "url": "https://example.com/mexican-spanish"
        }
    }
}
```

When a package is requested, a language may be specified. The package can contain a `languages` field which contains
the language-specific fields for each supported language, which over-write the fields in the root.

## IoD Server

Using the development config, GPII will provide package data from [testData/installOnDemand](testData/installOnDemand).

But, if it detects a running instance of the server [stegru/gpii-iod](https://github.com/stegru/gpii-iod) somewhere on
the network then that will be used instead.
