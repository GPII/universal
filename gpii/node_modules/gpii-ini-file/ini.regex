# The ini file regular expression.
# Groups:
#  - section: The section name
#  - sectionCount: The [ characters.
#  or:
#  - key: The name of the value
#  - value, value_ml_indent, value_ml_quote, or value_quote: The value.
#  - prefix: Everything up to the value
#  - indent: The indentation
#  - qqq: The quotes used around value_lines
#  - q: The quote used around value_quote
#  - suffix: Everything after the value + quotes (normally just \n)

# Skip leading space and comments
^
(?!\s*[;#]) # Comments
(
    # Section name, including surrounding brackets
    \s*((?<sectionCount>\[+)(?<section>[^\]]+)\]+)
|
    # key=value
    (
        # everything before the value
        (?<prefix>
            (?<indent>[^\S\n]*)
            # The key name
            (?<key>[^\n=]*?)
            ((?!$)\s)*[=:]((?!$)\s)*
        )
        # values
        (
            # multi-line, wrapped with 3 double or single quotes
            ((?<qqq>"{3}|'{3})(?<value_ml_quote>((?!\k<qqq>).)*)\k<qqq>)
            # quoted
            |((?<q>["'])(?<value_quote>[^\n]*)\k<q>)
            # unquoted multi-line
            |(?<value_ml_indent>
                [^\n]* # first line
                (\n\k<indent>[^\S\n]+(?![#;\s])[^\n]*(?=\n))+ # next indented lines
            )
            # plain
            |(?<value>[^\r\n]*$)
        )
        # whitespace after the value
        (?<suffix>
            [^\S\n]*(\r?\n)?
        )
    )
)
